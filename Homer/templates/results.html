<!DOCTYPE html>
<html>

    <head>
        <title>Results!</title>
        <link rel="stylesheet" href="../static/main.css">
        <link rel="extraStuff1" href="../static/main.js">
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script>console.log("Finding AQI")
            fetch("https://api.weatherbit.io/v2.0/current?&postal_code="+document.location.href.split('?')[1]+"&country=US&key=9b56e1214a514320bd53f194caeec05f")
            .then(res =>  res.json())
            .then(res=> {
                const aqiLabel = document.getElementById("aqi-label");
                let aqi = res["data"][0]["aqi"];
                aqiLabel.append(aqi);
                let city = res["data"][0]["city_name"]
                let state = res["data"][0]["state_code"]
                const locLabel = document.getElementById("location");
                locLabel.innerHTML = city+", "+state;

                let aqiNum = parseInt(aqi);
                if(aqiNum <= 50) {
                    aqiLabel.style.color = "green";
                    aqiLabel.append(" (Good)")
                }
                else if(aqiNum > 50 && aqiNum <= 100) {
                    aqiLabel.style.color = "yellow";
                    aqiLabel.style.textShadow = "5px 5px 1px #ff0000, 10px 10px 1px #0000ff";
                    aqiLabel.append(" (Poor)")
                }
                else if(aqiNum > 100 && aqiNum <= 150) {
                    aqiLabel.style.color = "red";
                    aqiLabel.append(" (Bad)")
                }
                else {
                    aqiLabel.style.color = "purple";
                    aqiLabel.append(" (Very bad)")
                }
            });</script>

    </head>
    
    <body id= "results-body" style = "background-color: #ffffcc;">

        <a href="/" class="green-button">Return to Search</a>
        <!-- <form id = "back-button" class = "green-button" action="index.html">
            <input type="submit" value="Return to Search">
        </form> -->

        <h1 class = "result-text" id="location"></h1>
        <h1 class = "result-text-header">Prevalent Natural Disasters</h1>
            <p class = "result-text">Earthquake Threat Level</p>
            <p class = "result-text" id="disasterLabel">ZIP Code: {{data["natDis"][0][0]}}, State: {{data["natDis"][0][1]}}, USA: {{data["natDis"][0][2]}}</p>
            <p class = "result-text">Volcano Threat Level</p>
            <p class = "result-text" id="disasterLabel">ZIP Code: {{data["natDis"][1][0]}}, State: {{data["natDis"][1][1]}}, USA: {{data["natDis"][1][2]}}</p>
            <p class = "result-text">Tornado Threat Level</p>
            <p class = "result-text" id="disasterLabel">ZIP Code: {{data["natDis"][2][0]}}, State: {{data["natDis"][2][1]}}, USA: {{data["natDis"][2][2]}}</p>
        <h1 class = "result-text-header">Local Toxic Waste: </h1>
            <p class = "result-text" id="toxicLabel">{% if 5>=data["waste"]|length %}
                {{data["waste"][0]}}{% for site in {{data["waste"][1:]}} %}, {{site}}{% endfor %}{% endif %}
            {% if data["waste"]|length>5 %}{% for site in {{data["waste"]}} %}{{site}}, {% endfor %}and more...{% endif %}</p> 
            <p></p>
        <h1 cclass = "result-text" id="aqi-label">Air Quality Index (AQI): </h1>
            <p></p>
    
        <h1 class = "result-text-header">Number of Nearby Recycling Plants:</h1>
        {% for key in {{data["recycle"]}}
        <p class = "result-text-header"> {{key}}: {{data["recycle"]["key"]</p>
        {% endfor %}

    
        <h1 class = "result-text-header">Sustainability</h1>
        <!--includes info on the region's average carbon emissions,
        local recycling centers, and how to be more sus at this home -->
        <p>Interested in leading a more sustainable life?\
            Check out <a href="/susTips">these tips</a>
        </p>

    </body>

</html>